{"version":3,"file":"prefabs-1KMUazAe.mjs","sources":["../src/prefabs/Chat.tsx","../src/prefabs/MediaDeviceMenu.tsx","../src/hooks/useWarnAboutMissingStyles.ts","../src/prefabs/PreJoin.tsx","../src/hooks/useSettingsToggle.ts","../src/components/controls/SettingsMenuToggle.tsx","../src/prefabs/ControlBar.tsx","../src/prefabs/VideoConference.tsx","../src/prefabs/AudioConference.tsx","../src/prefabs/VoiceAssistantControlBar.tsx"],"sourcesContent":["import type { ChatMessage, ChatOptions } from '@livekit/components-core';\r\nimport * as React from 'react';\r\nimport { useMaybeLayoutContext } from '../context';\r\nimport { cloneSingleChild } from '../utils';\r\nimport type { MessageFormatter } from '../components/ChatEntry';\r\nimport { ChatEntry } from '../components/ChatEntry';\r\nimport { useChat } from '../hooks/useChat';\r\nimport { ChatToggle } from '../components';\r\nimport { ChatCloseIcon } from '../assets/icons';\r\n\r\n/** @public */\r\nexport interface ChatProps extends React.HTMLAttributes<HTMLDivElement>, ChatOptions {\r\n  messageFormatter?: MessageFormatter;\r\n}\r\n\r\n/**\r\n * The Chat component provides ready-to-use chat functionality in a LiveKit room.\r\n * Messages are distributed to all participants in the room in real-time.\r\n *\r\n * @remarks\r\n * - Only users who are in the room at the time of dispatch will receive messages\r\n * - Message history is not persisted between sessions\r\n * - Requires `@livekit/components-styles` to be imported for styling\r\n *\r\n * @example\r\n * ```tsx\r\n * import '@livekit/components-styles';\r\n *\r\n * function Room() {\r\n *   return (\r\n *     <LiveKitRoom data-lk-theme=\"default\">\r\n *       <Chat />\r\n *     </LiveKitRoom>\r\n *   );\r\n * }\r\n * ```\r\n *\r\n * For custom styling, refer to: https://docs.livekit.io/reference/components/react/concepts/style-components/\r\n *\r\n * @public\r\n */\r\nexport function Chat({\r\n  messageFormatter,\r\n  messageDecoder,\r\n  messageEncoder,\r\n  channelTopic,\r\n  ...props\r\n}: ChatProps) {\r\n  const inputRef = React.useRef<HTMLInputElement>(null);\r\n  const ulRef = React.useRef<HTMLUListElement>(null);\r\n\r\n  const chatOptions: ChatOptions = React.useMemo(() => {\r\n    return { messageDecoder, messageEncoder, channelTopic };\r\n  }, [messageDecoder, messageEncoder, channelTopic]);\r\n\r\n  const { send, chatMessages, isSending } = useChat(chatOptions);\r\n\r\n  const layoutContext = useMaybeLayoutContext();\r\n  const lastReadMsgAt = React.useRef<ChatMessage['timestamp']>(0);\r\n\r\n  async function handleSubmit(event: React.FormEvent) {\r\n    event.preventDefault();\r\n    if (inputRef.current && inputRef.current.value.trim() !== '') {\r\n      if (send) {\r\n        await send(inputRef.current.value);\r\n        inputRef.current.value = '';\r\n        inputRef.current.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    if (ulRef) {\r\n      ulRef.current?.scrollTo({ top: ulRef.current.scrollHeight });\r\n    }\r\n  }, [ulRef, chatMessages]);\r\n\r\n  React.useEffect(() => {\r\n    if (!layoutContext || chatMessages.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      layoutContext.widget.state?.showChat &&\r\n      chatMessages.length > 0 &&\r\n      lastReadMsgAt.current !== chatMessages[chatMessages.length - 1]?.timestamp\r\n    ) {\r\n      lastReadMsgAt.current = chatMessages[chatMessages.length - 1]?.timestamp;\r\n      return;\r\n    }\r\n\r\n    const unreadMessageCount = chatMessages.filter(\r\n      (msg) => !lastReadMsgAt.current || msg.timestamp > lastReadMsgAt.current,\r\n    ).length;\r\n\r\n    const { widget } = layoutContext;\r\n    if (unreadMessageCount > 0 && widget.state?.unreadMessages !== unreadMessageCount) {\r\n      widget.dispatch?.({ msg: 'unread_msg', count: unreadMessageCount });\r\n    }\r\n  }, [chatMessages, layoutContext?.widget]);\r\n\r\n  return (\r\n    <div {...props} className=\"lk-chat\">\r\n      <div className=\"lk-chat-header\">\r\n        Messages\r\n        {layoutContext && (\r\n          <ChatToggle className=\"lk-close-button\">\r\n            <ChatCloseIcon />\r\n          </ChatToggle>\r\n        )}\r\n      </div>\r\n\r\n      <ul className=\"lk-list lk-chat-messages\" ref={ulRef}>\r\n        {props.children\r\n          ? chatMessages.map((msg, idx) =>\r\n              cloneSingleChild(props.children, {\r\n                entry: msg,\r\n                key: msg.id ?? idx,\r\n                messageFormatter,\r\n              }),\r\n            )\r\n          : chatMessages.map((msg, idx, allMsg) => {\r\n              const hideName = idx >= 1 && allMsg[idx - 1].from === msg.from;\r\n              // If the time delta between two messages is bigger than 60s show timestamp.\r\n              const hideTimestamp = idx >= 1 && msg.timestamp - allMsg[idx - 1].timestamp < 60_000;\r\n\r\n              return (\r\n                <ChatEntry\r\n                  key={msg.id ?? idx}\r\n                  hideName={hideName}\r\n                  hideTimestamp={hideName === false ? false : hideTimestamp} // If we show the name always show the timestamp as well.\r\n                  entry={msg}\r\n                  messageFormatter={messageFormatter}\r\n                />\r\n              );\r\n            })}\r\n      </ul>\r\n      <form className=\"lk-chat-form\" onSubmit={handleSubmit}>\r\n        <input\r\n          className=\"lk-form-control lk-chat-form-input\"\r\n          disabled={isSending}\r\n          ref={inputRef}\r\n          type=\"text\"\r\n          placeholder=\"Enter a message...\"\r\n          onInput={(ev) => ev.stopPropagation()}\r\n          onKeyDown={(ev) => ev.stopPropagation()}\r\n          onKeyUp={(ev) => ev.stopPropagation()}\r\n        />\r\n        <button type=\"submit\" className=\"lk-button lk-chat-form-button\" disabled={isSending}>\r\n          Send\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","import { computeMenuPosition, wasClickOutside } from '@livekit/components-core';\r\nimport * as React from 'react';\r\nimport { MediaDeviceSelect } from '../components/controls/MediaDeviceSelect';\r\nimport { log } from '@livekit/components-core';\r\nimport type { LocalAudioTrack, LocalVideoTrack } from 'livekit-client';\r\n\r\n/** @public */\r\nexport interface MediaDeviceMenuProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n  kind?: MediaDeviceKind;\r\n  initialSelection?: string;\r\n  onActiveDeviceChange?: (kind: MediaDeviceKind, deviceId: string) => void;\r\n  tracks?: Partial<Record<MediaDeviceKind, LocalAudioTrack | LocalVideoTrack | undefined>>;\r\n  /**\r\n   * this will call getUserMedia if the permissions are not yet given to enumerate the devices with device labels.\r\n   * in some browsers multiple calls to getUserMedia result in multiple permission prompts.\r\n   * It's generally advised only flip this to true, once a (preview) track has been acquired successfully with the\r\n   * appropriate permissions.\r\n   *\r\n   * @see {@link PreJoin}\r\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices | MDN enumerateDevices}\r\n   */\r\n  requestPermissions?: boolean;\r\n}\r\n\r\n/**\r\n * The `MediaDeviceMenu` component is a button that opens a menu that lists\r\n * all media devices and allows the user to select them.\r\n *\r\n * @remarks\r\n * This component is implemented with the `MediaDeviceSelect` LiveKit components.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <MediaDeviceMenu />\r\n * </LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function MediaDeviceMenu({\r\n  kind,\r\n  initialSelection,\r\n  onActiveDeviceChange,\r\n  tracks,\r\n  requestPermissions = false,\r\n  ...props\r\n}: MediaDeviceMenuProps) {\r\n  const [isOpen, setIsOpen] = React.useState(false);\r\n  const [devices, setDevices] = React.useState<MediaDeviceInfo[]>([]);\r\n  const [updateRequired, setUpdateRequired] = React.useState<boolean>(true);\r\n  const [needPermissions, setNeedPermissions] = React.useState(requestPermissions);\r\n\r\n  const handleActiveDeviceChange = (kind: MediaDeviceKind, deviceId: string) => {\r\n    log.debug('handle device change');\r\n    setIsOpen(false);\r\n    onActiveDeviceChange?.(kind, deviceId);\r\n  };\r\n\r\n  const button = React.useRef<HTMLButtonElement>(null);\r\n  const tooltip = React.useRef<HTMLDivElement>(null);\r\n\r\n  React.useLayoutEffect(() => {\r\n    if (isOpen) {\r\n      setNeedPermissions(true);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  React.useLayoutEffect(() => {\r\n    if (button.current && tooltip.current && (devices || updateRequired)) {\r\n      computeMenuPosition(button.current, tooltip.current).then(({ x, y }) => {\r\n        if (tooltip.current) {\r\n          Object.assign(tooltip.current.style, { left: `${x}px`, top: `${y}px` });\r\n        }\r\n      });\r\n    }\r\n    setUpdateRequired(false);\r\n  }, [button, tooltip, devices, updateRequired]);\r\n\r\n  const handleClickOutside = React.useCallback(\r\n    (event: MouseEvent) => {\r\n      if (!tooltip.current) {\r\n        return;\r\n      }\r\n      if (event.target === button.current) {\r\n        return;\r\n      }\r\n      if (isOpen && wasClickOutside(tooltip.current, event)) {\r\n        setIsOpen(false);\r\n      }\r\n    },\r\n    [isOpen, tooltip, button],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    document.addEventListener<'click'>('click', handleClickOutside);\r\n    window.addEventListener<'resize'>('resize', () => setUpdateRequired(true));\r\n    return () => {\r\n      document.removeEventListener<'click'>('click', handleClickOutside);\r\n      window.removeEventListener<'resize'>('resize', () => setUpdateRequired(true));\r\n    };\r\n  }, [handleClickOutside, setUpdateRequired]);\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        className=\"lk-button lk-button-menu\"\r\n        aria-pressed={isOpen}\r\n        {...props}\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        ref={button}\r\n      >\r\n        {props.children}\r\n      </button>\r\n      {/** only render when enabled in order to make sure that the permissions are requested only if the menu is enabled */}\r\n      {!props.disabled && (\r\n        <div\r\n          className=\"lk-device-menu\"\r\n          ref={tooltip}\r\n          style={{ visibility: isOpen ? 'visible' : 'hidden' }}\r\n        >\r\n          {kind ? (\r\n            <MediaDeviceSelect\r\n              initialSelection={initialSelection}\r\n              onActiveDeviceChange={(deviceId) => handleActiveDeviceChange(kind, deviceId)}\r\n              onDeviceListChange={setDevices}\r\n              kind={kind}\r\n              track={tracks?.[kind]}\r\n              requestPermissions={needPermissions}\r\n            />\r\n          ) : (\r\n            <>\r\n              <div className=\"lk-device-menu-heading\">Audio inputs</div>\r\n              <MediaDeviceSelect\r\n                kind=\"audioinput\"\r\n                onActiveDeviceChange={(deviceId) =>\r\n                  handleActiveDeviceChange('audioinput', deviceId)\r\n                }\r\n                onDeviceListChange={setDevices}\r\n                track={tracks?.audioinput}\r\n                requestPermissions={needPermissions}\r\n              />\r\n              <div className=\"lk-device-menu-heading\">Video inputs</div>\r\n              <MediaDeviceSelect\r\n                kind=\"videoinput\"\r\n                onActiveDeviceChange={(deviceId) =>\r\n                  handleActiveDeviceChange('videoinput', deviceId)\r\n                }\r\n                onDeviceListChange={setDevices}\r\n                track={tracks?.videoinput}\r\n                requestPermissions={needPermissions}\r\n              />\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport { warnAboutMissingStyles } from '../utils';\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function useWarnAboutMissingStyles() {\r\n  React.useEffect(() => {\r\n    warnAboutMissingStyles();\r\n  }, []);\r\n}\r\n","import type {\r\n  CreateLocalTracksOptions,\r\n  LocalAudioTrack,\r\n  LocalTrack,\r\n  LocalVideoTrack,\r\n  TrackProcessor,\r\n} from 'livekit-client';\r\nimport {\r\n  createLocalAudioTrack,\r\n  createLocalTracks,\r\n  createLocalVideoTrack,\r\n  facingModeFromLocalTrack,\r\n  Track,\r\n  VideoPresets,\r\n  Mutex,\r\n} from 'livekit-client';\r\nimport * as React from 'react';\r\nimport { MediaDeviceMenu } from './MediaDeviceMenu';\r\nimport { TrackToggle } from '../components/controls/TrackToggle';\r\nimport type { LocalUserChoices } from '@livekit/components-core';\r\nimport { log } from '@livekit/components-core';\r\nimport { ParticipantPlaceholder } from '../assets/images';\r\nimport { useMediaDevices, usePersistentUserChoices } from '../hooks';\r\nimport { useWarnAboutMissingStyles } from '../hooks/useWarnAboutMissingStyles';\r\nimport { roomOptionsStringifyReplacer } from '../utils';\r\n\r\n/**\r\n * Props for the PreJoin component.\r\n * @public\r\n */\r\nexport interface PreJoinProps\r\n  extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onSubmit' | 'onError'> {\r\n  /** This function is called with the `LocalUserChoices` if validation is passed. */\r\n  onSubmit?: (values: LocalUserChoices) => void;\r\n  /**\r\n   * Provide your custom validation function. Only if validation is successful the user choices are past to the onSubmit callback.\r\n   */\r\n  onValidate?: (values: LocalUserChoices) => boolean;\r\n  onError?: (error: Error) => void;\r\n  /** Prefill the input form with initial values. */\r\n  defaults?: Partial<LocalUserChoices>;\r\n  /** Display a debug window for your convenience. */\r\n  debug?: boolean;\r\n  joinLabel?: string;\r\n  micLabel?: string;\r\n  camLabel?: string;\r\n  userLabel?: string;\r\n  /**\r\n   * If true, user choices are persisted across sessions.\r\n   * @defaultValue true\r\n   * @alpha\r\n   */\r\n  persistUserChoices?: boolean;\r\n  videoProcessor?: TrackProcessor<Track.Kind.Video>;\r\n}\r\n\r\n/** @public */\r\nexport function usePreviewTracks(\r\n  options: CreateLocalTracksOptions,\r\n  onError?: (err: Error) => void,\r\n) {\r\n  const [tracks, setTracks] = React.useState<LocalTrack[]>();\r\n\r\n  const trackLock = React.useMemo(() => new Mutex(), []);\r\n\r\n  React.useEffect(() => {\r\n    let needsCleanup = false;\r\n    let localTracks: Array<LocalTrack> = [];\r\n    trackLock.lock().then(async (unlock) => {\r\n      try {\r\n        if (options.audio || options.video) {\r\n          localTracks = await createLocalTracks(options);\r\n\r\n          if (needsCleanup) {\r\n            localTracks.forEach((tr) => tr.stop());\r\n          } else {\r\n            setTracks(localTracks);\r\n          }\r\n        }\r\n      } catch (e: unknown) {\r\n        if (onError && e instanceof Error) {\r\n          onError(e);\r\n        } else {\r\n          log.error(e);\r\n        }\r\n      } finally {\r\n        unlock();\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      needsCleanup = true;\r\n      localTracks.forEach((track) => {\r\n        track.stop();\r\n      });\r\n    };\r\n  }, [JSON.stringify(options, roomOptionsStringifyReplacer), onError, trackLock]);\r\n\r\n  return tracks;\r\n}\r\n\r\n/**\r\n * @public\r\n * @deprecated use `usePreviewTracks` instead\r\n */\r\nexport function usePreviewDevice<T extends LocalVideoTrack | LocalAudioTrack>(\r\n  enabled: boolean,\r\n  deviceId: string,\r\n  kind: 'videoinput' | 'audioinput',\r\n) {\r\n  const [deviceError, setDeviceError] = React.useState<Error | null>(null);\r\n  const [isCreatingTrack, setIsCreatingTrack] = React.useState<boolean>(false);\r\n\r\n  const devices = useMediaDevices({ kind });\r\n  const [selectedDevice, setSelectedDevice] = React.useState<MediaDeviceInfo | undefined>(\r\n    undefined,\r\n  );\r\n\r\n  const [localTrack, setLocalTrack] = React.useState<T>();\r\n  const [localDeviceId, setLocalDeviceId] = React.useState<string>(deviceId);\r\n\r\n  React.useEffect(() => {\r\n    setLocalDeviceId(deviceId);\r\n  }, [deviceId]);\r\n\r\n  const createTrack = async (deviceId: string, kind: 'videoinput' | 'audioinput') => {\r\n    try {\r\n      const track =\r\n        kind === 'videoinput'\r\n          ? await createLocalVideoTrack({\r\n              deviceId: deviceId,\r\n              resolution: VideoPresets.h720.resolution,\r\n            })\r\n          : await createLocalAudioTrack({ deviceId });\r\n\r\n      const newDeviceId = await track.getDeviceId(false);\r\n      if (newDeviceId && deviceId !== newDeviceId) {\r\n        prevDeviceId.current = newDeviceId;\r\n        setLocalDeviceId(newDeviceId);\r\n      }\r\n      setLocalTrack(track as T);\r\n    } catch (e) {\r\n      if (e instanceof Error) {\r\n        setDeviceError(e);\r\n      }\r\n    }\r\n  };\r\n\r\n  const switchDevice = async (track: LocalVideoTrack | LocalAudioTrack, id: string) => {\r\n    await track.setDeviceId(id);\r\n    prevDeviceId.current = id;\r\n  };\r\n\r\n  const prevDeviceId = React.useRef(localDeviceId);\r\n\r\n  React.useEffect(() => {\r\n    if (enabled && !localTrack && !deviceError && !isCreatingTrack) {\r\n      log.debug('creating track', kind);\r\n      setIsCreatingTrack(true);\r\n      createTrack(localDeviceId, kind).finally(() => {\r\n        setIsCreatingTrack(false);\r\n      });\r\n    }\r\n  }, [enabled, localTrack, deviceError, isCreatingTrack]);\r\n\r\n  // switch camera device\r\n  React.useEffect(() => {\r\n    if (!localTrack) {\r\n      return;\r\n    }\r\n    if (!enabled) {\r\n      log.debug(`muting ${kind} track`);\r\n      localTrack.mute().then(() => log.debug(localTrack.mediaStreamTrack));\r\n    } else if (selectedDevice?.deviceId && prevDeviceId.current !== selectedDevice?.deviceId) {\r\n      log.debug(`switching ${kind} device from`, prevDeviceId.current, selectedDevice.deviceId);\r\n      switchDevice(localTrack, selectedDevice.deviceId);\r\n    } else {\r\n      log.debug(`unmuting local ${kind} track`);\r\n      localTrack.unmute();\r\n    }\r\n  }, [localTrack, selectedDevice, enabled, kind]);\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (localTrack) {\r\n        log.debug(`stopping local ${kind} track`);\r\n        localTrack.stop();\r\n        localTrack.mute();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    setSelectedDevice(devices?.find((dev) => dev.deviceId === localDeviceId));\r\n  }, [localDeviceId, devices]);\r\n\r\n  return {\r\n    selectedDevice,\r\n    localTrack,\r\n    deviceError,\r\n  };\r\n}\r\n\r\n/**\r\n * The `PreJoin` prefab component is normally presented to the user before he enters a room.\r\n * This component allows the user to check and select the preferred media device (camera und microphone).\r\n * On submit the user decisions are returned, which can then be passed on to the `LiveKitRoom` so that the user enters the room with the correct media devices.\r\n *\r\n * @remarks\r\n * This component is independent of the `LiveKitRoom` component and should not be nested within it.\r\n * Because it only accesses the local media tracks this component is self-contained and works without connection to the LiveKit server.\r\n *\r\n * @example\r\n * ```tsx\r\n * <PreJoin />\r\n * ```\r\n * @public\r\n */\r\nexport function PreJoin({\r\n  defaults = {},\r\n  onValidate,\r\n  onSubmit,\r\n  onError,\r\n  debug,\r\n  joinLabel = 'Join Room',\r\n  micLabel = 'Microphone',\r\n  camLabel = 'Camera',\r\n  userLabel = 'Username',\r\n  persistUserChoices = true,\r\n  videoProcessor,\r\n  ...htmlProps\r\n}: PreJoinProps) {\r\n  const {\r\n    userChoices: initialUserChoices,\r\n    saveAudioInputDeviceId,\r\n    saveAudioInputEnabled,\r\n    saveVideoInputDeviceId,\r\n    saveVideoInputEnabled,\r\n    saveUsername,\r\n  } = usePersistentUserChoices({\r\n    defaults,\r\n    preventSave: !persistUserChoices,\r\n    preventLoad: !persistUserChoices,\r\n  });\r\n\r\n  const [userChoices, setUserChoices] = React.useState(initialUserChoices);\r\n\r\n  // Initialize device settings\r\n  const [audioEnabled, setAudioEnabled] = React.useState<boolean>(userChoices.audioEnabled);\r\n  const [videoEnabled, setVideoEnabled] = React.useState<boolean>(userChoices.videoEnabled);\r\n  const [audioDeviceId, setAudioDeviceId] = React.useState<string>(userChoices.audioDeviceId);\r\n  const [videoDeviceId, setVideoDeviceId] = React.useState<string>(userChoices.videoDeviceId);\r\n  const [username, setUsername] = React.useState(userChoices.username);\r\n\r\n  // Save user choices to persistent storage.\r\n  React.useEffect(() => {\r\n    saveAudioInputEnabled(audioEnabled);\r\n  }, [audioEnabled, saveAudioInputEnabled]);\r\n  React.useEffect(() => {\r\n    saveVideoInputEnabled(videoEnabled);\r\n  }, [videoEnabled, saveVideoInputEnabled]);\r\n  React.useEffect(() => {\r\n    saveAudioInputDeviceId(audioDeviceId);\r\n  }, [audioDeviceId, saveAudioInputDeviceId]);\r\n  React.useEffect(() => {\r\n    saveVideoInputDeviceId(videoDeviceId);\r\n  }, [videoDeviceId, saveVideoInputDeviceId]);\r\n  React.useEffect(() => {\r\n    saveUsername(username);\r\n  }, [username, saveUsername]);\r\n\r\n  const tracks = usePreviewTracks(\r\n    {\r\n      audio: audioEnabled ? { deviceId: initialUserChoices.audioDeviceId } : false,\r\n      video: videoEnabled\r\n        ? { deviceId: initialUserChoices.videoDeviceId, processor: videoProcessor }\r\n        : false,\r\n    },\r\n    onError,\r\n  );\r\n\r\n  const videoEl = React.useRef(null);\r\n\r\n  const videoTrack = React.useMemo(\r\n    () => tracks?.filter((track) => track.kind === Track.Kind.Video)[0] as LocalVideoTrack,\r\n    [tracks],\r\n  );\r\n\r\n  const facingMode = React.useMemo(() => {\r\n    if (videoTrack) {\r\n      const { facingMode } = facingModeFromLocalTrack(videoTrack);\r\n      return facingMode;\r\n    } else {\r\n      return 'undefined';\r\n    }\r\n  }, [videoTrack]);\r\n\r\n  const audioTrack = React.useMemo(\r\n    () => tracks?.filter((track) => track.kind === Track.Kind.Audio)[0] as LocalAudioTrack,\r\n    [tracks],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (videoEl.current && videoTrack) {\r\n      videoTrack.unmute();\r\n      videoTrack.attach(videoEl.current);\r\n    }\r\n\r\n    return () => {\r\n      videoTrack?.detach();\r\n    };\r\n  }, [videoTrack]);\r\n\r\n  const [isValid, setIsValid] = React.useState<boolean>();\r\n\r\n  const handleValidation = React.useCallback(\r\n    (values: LocalUserChoices) => {\r\n      if (typeof onValidate === 'function') {\r\n        return onValidate(values);\r\n      } else {\r\n        return values.username !== '';\r\n      }\r\n    },\r\n    [onValidate],\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    const newUserChoices = {\r\n      username,\r\n      videoEnabled,\r\n      videoDeviceId,\r\n      audioEnabled,\r\n      audioDeviceId,\r\n    };\r\n    setUserChoices(newUserChoices);\r\n    setIsValid(handleValidation(newUserChoices));\r\n  }, [username, videoEnabled, handleValidation, audioEnabled, audioDeviceId, videoDeviceId]);\r\n\r\n  function handleSubmit(event: React.FormEvent) {\r\n    event.preventDefault();\r\n    if (handleValidation(userChoices)) {\r\n      if (typeof onSubmit === 'function') {\r\n        onSubmit(userChoices);\r\n      }\r\n    } else {\r\n      log.warn('Validation failed with: ', userChoices);\r\n    }\r\n  }\r\n\r\n  useWarnAboutMissingStyles();\r\n\r\n  return (\r\n    <div className=\"lk-prejoin\" {...htmlProps}>\r\n      <div className=\"lk-video-container\">\r\n        {videoTrack && (\r\n          <video ref={videoEl} width=\"1280\" height=\"720\" data-lk-facing-mode={facingMode} />\r\n        )}\r\n        {(!videoTrack || !videoEnabled) && (\r\n          <div className=\"lk-camera-off-note\">\r\n            <ParticipantPlaceholder />\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"lk-button-group-container\">\r\n        <div className=\"lk-button-group audio\">\r\n          <TrackToggle\r\n            initialState={audioEnabled}\r\n            source={Track.Source.Microphone}\r\n            onChange={(enabled) => setAudioEnabled(enabled)}\r\n          >\r\n            {micLabel}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              initialSelection={audioDeviceId}\r\n              kind=\"audioinput\"\r\n              disabled={!audioTrack}\r\n              tracks={{ audioinput: audioTrack }}\r\n              onActiveDeviceChange={(_, id) => setAudioDeviceId(id)}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className=\"lk-button-group video\">\r\n          <TrackToggle\r\n            initialState={videoEnabled}\r\n            source={Track.Source.Camera}\r\n            onChange={(enabled) => setVideoEnabled(enabled)}\r\n          >\r\n            {camLabel}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              initialSelection={videoDeviceId}\r\n              kind=\"videoinput\"\r\n              disabled={!videoTrack}\r\n              tracks={{ videoinput: videoTrack }}\r\n              onActiveDeviceChange={(_, id) => setVideoDeviceId(id)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <form className=\"lk-username-container\">\r\n        <input\r\n          className=\"lk-form-control\"\r\n          id=\"username\"\r\n          name=\"username\"\r\n          type=\"text\"\r\n          defaultValue={username}\r\n          placeholder={userLabel}\r\n          onChange={(inputEl) => setUsername(inputEl.target.value)}\r\n          autoComplete=\"off\"\r\n        />\r\n        <button\r\n          className=\"lk-button lk-join-button\"\r\n          type=\"submit\"\r\n          onClick={handleSubmit}\r\n          disabled={!isValid}\r\n        >\r\n          {joinLabel}\r\n        </button>\r\n      </form>\r\n\r\n      {debug && (\r\n        <>\r\n          <strong>User Choices:</strong>\r\n          <ul className=\"lk-list\" style={{ overflow: 'hidden', maxWidth: '15rem' }}>\r\n            <li>Username: {`${userChoices.username}`}</li>\r\n            <li>Video Enabled: {`${userChoices.videoEnabled}`}</li>\r\n            <li>Audio Enabled: {`${userChoices.audioEnabled}`}</li>\r\n            <li>Video Device: {`${userChoices.videoDeviceId}`}</li>\r\n            <li>Audio Device: {`${userChoices.audioDeviceId}`}</li>\r\n          </ul>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useLayoutContext } from '../context';\r\nimport { mergeProps } from '../mergeProps';\r\nimport * as React from 'react';\r\n\r\n/** @alpha */\r\nexport interface UseSettingsToggleProps {\r\n  props: React.ButtonHTMLAttributes<HTMLButtonElement>;\r\n}\r\n\r\n/**\r\n * The `useSettingsToggle` hook provides state and functions for toggling the settings menu.\r\n * @remarks\r\n * Depends on the `LayoutContext` to work properly.\r\n * @see {@link SettingsMenu}\r\n * @alpha\r\n */\r\nexport function useSettingsToggle({ props }: UseSettingsToggleProps) {\r\n  const { dispatch, state } = useLayoutContext().widget;\r\n  const className = 'lk-button lk-settings-toggle';\r\n\r\n  const mergedProps = React.useMemo(() => {\r\n    return mergeProps(props, {\r\n      className,\r\n      onClick: () => {\r\n        if (dispatch) dispatch({ msg: 'toggle_settings' });\r\n      },\r\n      'aria-pressed': state?.showSettings ? 'true' : 'false',\r\n    });\r\n  }, [props, className, dispatch, state]);\r\n\r\n  return { mergedProps };\r\n}\r\n","import * as React from 'react';\r\nimport { useSettingsToggle } from '../../hooks/useSettingsToggle';\r\n\r\n/** @alpha */\r\nexport interface SettingsMenuToggleProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {}\r\n\r\n/**\r\n * The `SettingsMenuToggle` component is a button that toggles the visibility of the `SettingsMenu` component.\r\n * @remarks\r\n * For the component to have any effect it has to live inside a `LayoutContext` context.\r\n *\r\n * @alpha\r\n */\r\nexport const SettingsMenuToggle: (\r\n  props: SettingsMenuToggleProps & React.RefAttributes<HTMLButtonElement>,\r\n) => React.ReactNode = /* @__PURE__ */ React.forwardRef<HTMLButtonElement, SettingsMenuToggleProps>(\r\n  function SettingsMenuToggle(props: SettingsMenuToggleProps, ref) {\r\n    const { mergedProps } = useSettingsToggle({ props });\r\n\r\n    return (\r\n      <button ref={ref} {...mergedProps}>\r\n        {props.children}\r\n      </button>\r\n    );\r\n  },\r\n);\r\n","import { Track } from 'livekit-client';\r\nimport * as React from 'react';\r\nimport { MediaDeviceMenu } from './MediaDeviceMenu';\r\nimport { DisconnectButton } from '../components/controls/DisconnectButton';\r\nimport { TrackToggle } from '../components/controls/TrackToggle';\r\nimport { ChatIcon, GearIcon, LeaveIcon } from '../assets/icons';\r\nimport { ChatToggle } from '../components/controls/ChatToggle';\r\nimport { useLocalParticipantPermissions, usePersistentUserChoices } from '../hooks';\r\nimport { useMediaQuery } from '../hooks/internal';\r\nimport { useMaybeLayoutContext } from '../context';\r\nimport { supportsScreenSharing } from '@livekit/components-core';\r\nimport { mergeProps } from '../utils';\r\nimport { StartMediaButton } from '../components/controls/StartMediaButton';\r\nimport { SettingsMenuToggle } from '../components/controls/SettingsMenuToggle';\r\n\r\n/** @public */\r\nexport type ControlBarControls = {\r\n  microphone?: boolean;\r\n  camera?: boolean;\r\n  chat?: boolean;\r\n  screenShare?: boolean;\r\n  leave?: boolean;\r\n  settings?: boolean;\r\n};\r\n\r\n/** @public */\r\nexport interface ControlBarProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  onDeviceError?: (error: { source: Track.Source; error: Error }) => void;\r\n  variation?: 'minimal' | 'verbose' | 'textOnly';\r\n  controls?: ControlBarControls;\r\n  /**\r\n   * If `true`, the user's device choices will be persisted.\r\n   * This will enable the user to have the same device choices when they rejoin the room.\r\n   * @defaultValue true\r\n   * @alpha\r\n   */\r\n  saveUserChoices?: boolean;\r\n}\r\n\r\n/**\r\n * The `ControlBar` prefab gives the user the basic user interface to control their\r\n * media devices (camera, microphone and screen share), open the `Chat` and leave the room.\r\n *\r\n * @remarks\r\n * This component is build with other LiveKit components like `TrackToggle`,\r\n * `DeviceSelectorButton`, `DisconnectButton` and `StartAudio`.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <ControlBar />\r\n * </LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function ControlBar({\r\n  variation,\r\n  controls,\r\n  saveUserChoices = true,\r\n  onDeviceError,\r\n  ...props\r\n}: ControlBarProps) {\r\n  const [isChatOpen, setIsChatOpen] = React.useState(false);\r\n  const layoutContext = useMaybeLayoutContext();\r\n  React.useEffect(() => {\r\n    if (layoutContext?.widget.state?.showChat !== undefined) {\r\n      setIsChatOpen(layoutContext?.widget.state?.showChat);\r\n    }\r\n  }, [layoutContext?.widget.state?.showChat]);\r\n  const isTooLittleSpace = useMediaQuery(`(max-width: ${isChatOpen ? 1000 : 760}px)`);\r\n\r\n  const defaultVariation = isTooLittleSpace ? 'minimal' : 'verbose';\r\n  variation ??= defaultVariation;\r\n\r\n  const visibleControls = { leave: true, ...controls };\r\n\r\n  const localPermissions = useLocalParticipantPermissions();\r\n\r\n  if (!localPermissions) {\r\n    visibleControls.camera = false;\r\n    visibleControls.chat = false;\r\n    visibleControls.microphone = false;\r\n    visibleControls.screenShare = false;\r\n  } else {\r\n    visibleControls.camera ??= localPermissions.canPublish;\r\n    visibleControls.microphone ??= localPermissions.canPublish;\r\n    visibleControls.screenShare ??= localPermissions.canPublish;\r\n    visibleControls.chat ??= localPermissions.canPublishData && controls?.chat;\r\n  }\r\n\r\n  const showIcon = React.useMemo(\r\n    () => variation === 'minimal' || variation === 'verbose',\r\n    [variation],\r\n  );\r\n  const showText = React.useMemo(\r\n    () => variation === 'textOnly' || variation === 'verbose',\r\n    [variation],\r\n  );\r\n\r\n  const browserSupportsScreenSharing = supportsScreenSharing();\r\n\r\n  const [isScreenShareEnabled, setIsScreenShareEnabled] = React.useState(false);\r\n\r\n  const onScreenShareChange = React.useCallback(\r\n    (enabled: boolean) => {\r\n      setIsScreenShareEnabled(enabled);\r\n    },\r\n    [setIsScreenShareEnabled],\r\n  );\r\n\r\n  const htmlProps = mergeProps({ className: 'lk-control-bar' }, props);\r\n\r\n  const {\r\n    saveAudioInputEnabled,\r\n    saveVideoInputEnabled,\r\n    saveAudioInputDeviceId,\r\n    saveVideoInputDeviceId,\r\n  } = usePersistentUserChoices({ preventSave: !saveUserChoices });\r\n\r\n  const microphoneOnChange = React.useCallback(\r\n    (enabled: boolean, isUserInitiated: boolean) =>\r\n      isUserInitiated ? saveAudioInputEnabled(enabled) : null,\r\n    [saveAudioInputEnabled],\r\n  );\r\n\r\n  const cameraOnChange = React.useCallback(\r\n    (enabled: boolean, isUserInitiated: boolean) =>\r\n      isUserInitiated ? saveVideoInputEnabled(enabled) : null,\r\n    [saveVideoInputEnabled],\r\n  );\r\n\r\n  return (\r\n    <div {...htmlProps}>\r\n      {visibleControls.microphone && (\r\n        <div className=\"lk-button-group\">\r\n          <TrackToggle\r\n            source={Track.Source.Microphone}\r\n            showIcon={showIcon}\r\n            onChange={microphoneOnChange}\r\n            onDeviceError={(error) => onDeviceError?.({ source: Track.Source.Microphone, error })}\r\n          >\r\n            {showText && 'Микрофон'}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              kind=\"audioinput\"\r\n              onActiveDeviceChange={(_kind, deviceId) =>\r\n                saveAudioInputDeviceId(deviceId ?? 'default')\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n      {visibleControls.camera && (\r\n        <div className=\"lk-button-group\">\r\n          <TrackToggle\r\n            source={Track.Source.Camera}\r\n            showIcon={showIcon}\r\n            onChange={cameraOnChange}\r\n            onDeviceError={(error) => onDeviceError?.({ source: Track.Source.Camera, error })}\r\n          >\r\n            {showText && 'Камера'}\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              kind=\"videoinput\"\r\n              onActiveDeviceChange={(_kind, deviceId) =>\r\n                saveVideoInputDeviceId(deviceId ?? 'default')\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n      {visibleControls.screenShare && browserSupportsScreenSharing && (\r\n        <TrackToggle\r\n          source={Track.Source.ScreenShare}\r\n          captureOptions={{ audio: true, selfBrowserSurface: 'include' }}\r\n          showIcon={showIcon}\r\n          onChange={onScreenShareChange}\r\n          onDeviceError={(error) => onDeviceError?.({ source: Track.Source.ScreenShare, error })}\r\n        >\r\n          {showText && (isScreenShareEnabled ? 'Stop screen share' : 'Share screen')}\r\n        </TrackToggle>\r\n      )}\r\n      {visibleControls.chat && (\r\n        <ChatToggle>\r\n          {showIcon && <ChatIcon />}\r\n          {showText && 'Чат'}\r\n        </ChatToggle>\r\n      )}\r\n      {visibleControls.settings && (\r\n        <SettingsMenuToggle>\r\n          {showIcon && <GearIcon />}\r\n          {showText && 'Настройки'}\r\n        </SettingsMenuToggle>\r\n      )}\r\n      {visibleControls.leave && (\r\n        <DisconnectButton>\r\n          {showIcon && <LeaveIcon />}\r\n          {showText && 'Отключиться'}\r\n        </DisconnectButton>\r\n      )}\r\n      <StartMediaButton />\r\n    </div>\r\n  );\r\n}\r\n","import type {\r\n  MessageDecoder,\r\n  MessageEncoder,\r\n  TrackReferenceOrPlaceholder,\r\n  WidgetState,\r\n} from '@livekit/components-core';\r\nimport { isEqualTrackRef, isTrackReference, isWeb, log } from '@livekit/components-core';\r\nimport { RoomEvent, Track } from 'livekit-client';\r\nimport * as React from 'react';\r\nimport type { MessageFormatter } from '../components';\r\nimport {\r\n  CarouselLayout,\r\n  ConnectionStateToast,\r\n  FocusLayout,\r\n  FocusLayoutContainer,\r\n  GridLayout,\r\n  LayoutContextProvider,\r\n  ParticipantTile,\r\n  RoomAudioRenderer,\r\n} from '../components';\r\nimport { useCreateLayoutContext } from '../context';\r\nimport { usePinnedTracks, useTracks } from '../hooks';\r\nimport { Chat } from './Chat';\r\nimport { ControlBar } from './ControlBar';\r\nimport { useWarnAboutMissingStyles } from '../hooks/useWarnAboutMissingStyles';\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface VideoConferenceProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  chatMessageFormatter?: MessageFormatter;\r\n  chatMessageEncoder?: MessageEncoder;\r\n  chatMessageDecoder?: MessageDecoder;\r\n  /** @alpha */\r\n  SettingsComponent?: React.ComponentType;\r\n}\r\n\r\n/**\r\n * The `VideoConference` ready-made component is your drop-in solution for a classic video conferencing application.\r\n * It provides functionality such as focusing on one participant, grid view with pagination to handle large numbers\r\n * of participants, basic non-persistent chat, screen sharing, and more.\r\n *\r\n * @remarks\r\n * The component is implemented with other LiveKit components like `FocusContextProvider`,\r\n * `GridLayout`, `ControlBar`, `FocusLayoutContainer` and `FocusLayout`.\r\n * You can use these components as a starting point for your own custom video conferencing application.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <VideoConference />\r\n * <LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function VideoConference({\r\n  chatMessageFormatter,\r\n  chatMessageDecoder,\r\n  chatMessageEncoder,\r\n  SettingsComponent,\r\n  ...props\r\n}: VideoConferenceProps) {\r\n  const [widgetState, setWidgetState] = React.useState<WidgetState>({\r\n    showChat: false,\r\n    unreadMessages: 0,\r\n    showSettings: false,\r\n  });\r\n  const lastAutoFocusedScreenShareTrack = React.useRef<TrackReferenceOrPlaceholder | null>(null);\r\n\r\n  const tracks = useTracks(\r\n    [\r\n      { source: Track.Source.Camera, withPlaceholder: true },\r\n      { source: Track.Source.ScreenShare, withPlaceholder: false },\r\n    ],\r\n    { updateOnlyOn: [RoomEvent.ActiveSpeakersChanged], onlySubscribed: false },\r\n  );\r\n\r\n  const widgetUpdate = (state: WidgetState) => {\r\n    log.debug('updating widget state', state);\r\n    setWidgetState(state);\r\n  };\r\n\r\n  const layoutContext = useCreateLayoutContext();\r\n\r\n  const screenShareTracks = tracks\r\n    .filter(isTrackReference)\r\n    .filter((track) => track.publication.source === Track.Source.ScreenShare);\r\n\r\n  const focusTrack = usePinnedTracks(layoutContext)?.[0];\r\n  const carouselTracks = tracks.filter((track) => !isEqualTrackRef(track, focusTrack));\r\n\r\n  React.useEffect(() => {\r\n    // If screen share tracks are published, and no pin is set explicitly, auto set the screen share.\r\n    if (\r\n      screenShareTracks.some((track) => track.publication.isSubscribed) &&\r\n      lastAutoFocusedScreenShareTrack.current === null\r\n    ) {\r\n      log.debug('Auto set screen share focus:', { newScreenShareTrack: screenShareTracks[0] });\r\n      layoutContext.pin.dispatch?.({ msg: 'set_pin', trackReference: screenShareTracks[0] });\r\n      lastAutoFocusedScreenShareTrack.current = screenShareTracks[0];\r\n    } else if (\r\n      lastAutoFocusedScreenShareTrack.current &&\r\n      !screenShareTracks.some(\r\n        (track) =>\r\n          track.publication.trackSid ===\r\n          lastAutoFocusedScreenShareTrack.current?.publication?.trackSid,\r\n      )\r\n    ) {\r\n      log.debug('Auto clearing screen share focus.');\r\n      layoutContext.pin.dispatch?.({ msg: 'clear_pin' });\r\n      lastAutoFocusedScreenShareTrack.current = null;\r\n    }\r\n    if (focusTrack && !isTrackReference(focusTrack)) {\r\n      const updatedFocusTrack = tracks.find(\r\n        (tr) =>\r\n          tr.participant.identity === focusTrack.participant.identity &&\r\n          tr.source === focusTrack.source,\r\n      );\r\n      if (updatedFocusTrack !== focusTrack && isTrackReference(updatedFocusTrack)) {\r\n        layoutContext.pin.dispatch?.({ msg: 'set_pin', trackReference: updatedFocusTrack });\r\n      }\r\n    }\r\n  }, [\r\n    screenShareTracks\r\n      .map((ref) => `${ref.publication.trackSid}_${ref.publication.isSubscribed}`)\r\n      .join(),\r\n    focusTrack?.publication?.trackSid,\r\n    tracks,\r\n  ]);\r\n\r\n  useWarnAboutMissingStyles();\r\n\r\n  return (\r\n    <div className=\"lk-video-conference\" {...props}>\r\n      {isWeb() && (\r\n        <LayoutContextProvider\r\n          value={layoutContext}\r\n          // onPinChange={handleFocusStateChange}\r\n          onWidgetChange={widgetUpdate}\r\n        >\r\n          <div className=\"lk-video-conference-inner\">\r\n            {!focusTrack ? (\r\n              <div className=\"lk-grid-layout-wrapper\">\r\n                <GridLayout tracks={tracks}>\r\n                  <ParticipantTile />\r\n                </GridLayout>\r\n              </div>\r\n            ) : (\r\n              <div className=\"lk-focus-layout-wrapper\">\r\n                <FocusLayoutContainer>\r\n                  <CarouselLayout tracks={carouselTracks}>\r\n                    <ParticipantTile />\r\n                  </CarouselLayout>\r\n                  {focusTrack && <FocusLayout trackRef={focusTrack} />}\r\n                </FocusLayoutContainer>\r\n              </div>\r\n            )}\r\n            <ControlBar controls={{ chat: true, settings: !!SettingsComponent }} />\r\n          </div>\r\n          <Chat\r\n            style={{ display: widgetState.showChat ? 'grid' : 'none' }}\r\n            messageFormatter={chatMessageFormatter}\r\n            messageEncoder={chatMessageEncoder}\r\n            messageDecoder={chatMessageDecoder}\r\n          />\r\n          {SettingsComponent && (\r\n            <div\r\n              className=\"lk-settings-menu-modal\"\r\n              style={{ display: widgetState.showSettings ? 'block' : 'none' }}\r\n            >\r\n              <SettingsComponent />\r\n            </div>\r\n          )}\r\n        </LayoutContextProvider>\r\n      )}\r\n      <RoomAudioRenderer />\r\n      <ConnectionStateToast />\r\n    </div>\r\n  );\r\n}\r\n","import * as React from 'react';\r\nimport { ControlBar } from './ControlBar';\r\n\r\nimport { ParticipantAudioTile } from '../components/participant/ParticipantAudioTile';\r\nimport { LayoutContextProvider } from '../components/layout/LayoutContextProvider';\r\nimport type { WidgetState } from '@livekit/components-core';\r\nimport { Chat } from './Chat';\r\nimport { TrackLoop } from '../components';\r\nimport { useTracks } from '../hooks';\r\nimport { useWarnAboutMissingStyles } from '../hooks/useWarnAboutMissingStyles';\r\nimport { Track } from 'livekit-client';\r\n\r\n/** @public */\r\nexport interface AudioConferenceProps extends React.HTMLAttributes<HTMLDivElement> {}\r\n\r\n/**\r\n * This component is the default setup of a classic LiveKit audio conferencing app.\r\n * It provides functionality like switching between participant grid view and focus view.\r\n *\r\n * @remarks\r\n * The component is implemented with other LiveKit components like `FocusContextProvider`,\r\n * `GridLayout`, `ControlBar`, `FocusLayoutContainer` and `FocusLayout`.\r\n *\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom>\r\n *   <AudioConference />\r\n * <LiveKitRoom>\r\n * ```\r\n * @public\r\n */\r\nexport function AudioConference({ ...props }: AudioConferenceProps) {\r\n  const [widgetState, setWidgetState] = React.useState<WidgetState>({\r\n    showChat: false,\r\n    unreadMessages: 0,\r\n  });\r\n\r\n  const audioTracks = useTracks([Track.Source.Microphone]);\r\n\r\n  useWarnAboutMissingStyles();\r\n\r\n  return (\r\n    <LayoutContextProvider onWidgetChange={setWidgetState}>\r\n      <div className=\"lk-audio-conference\" {...props}>\r\n        <div className=\"lk-audio-conference-stage\">\r\n          <TrackLoop tracks={audioTracks}>\r\n            <ParticipantAudioTile />\r\n          </TrackLoop>\r\n        </div>\r\n        <ControlBar\r\n          controls={{ microphone: true, screenShare: false, camera: false, chat: true }}\r\n        />\r\n        {widgetState.showChat && <Chat />}\r\n      </div>\r\n    </LayoutContextProvider>\r\n  );\r\n}\r\n","import { Track } from 'livekit-client';\r\nimport * as React from 'react';\r\nimport { MediaDeviceMenu } from './MediaDeviceMenu';\r\nimport { DisconnectButton } from '../components/controls/DisconnectButton';\r\nimport { TrackToggle } from '../components/controls/TrackToggle';\r\nimport {\r\n  useLocalParticipant,\r\n  useLocalParticipantPermissions,\r\n  usePersistentUserChoices,\r\n} from '../hooks';\r\nimport { mergeProps } from '../utils';\r\nimport { StartMediaButton } from '../components/controls/StartMediaButton';\r\nimport { BarVisualizer } from '../components';\r\nimport type { TrackReferenceOrPlaceholder } from '@livekit/components-core';\r\n\r\n/** @beta */\r\nexport type VoiceAssistantControlBarControls = {\r\n  microphone?: boolean;\r\n  leave?: boolean;\r\n};\r\n\r\n/** @beta */\r\nexport interface VoiceAssistantControlBarProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  onDeviceError?: (error: { source: Track.Source; error: Error }) => void;\r\n  controls?: VoiceAssistantControlBarControls;\r\n  /**\r\n   * If `true`, the user's device choices will be persisted.\r\n   * This will enables the user to have the same device choices when they rejoin the room.\r\n   * @defaultValue true\r\n   */\r\n  saveUserChoices?: boolean;\r\n}\r\n\r\n/**\r\n * @example\r\n * ```tsx\r\n * <LiveKitRoom ... >\r\n *   <VoiceAssistantControlBar />\r\n * </LiveKitRoom>\r\n * ```\r\n * @beta\r\n */\r\nexport function VoiceAssistantControlBar({\r\n  controls,\r\n  saveUserChoices = true,\r\n  onDeviceError,\r\n  ...props\r\n}: VoiceAssistantControlBarProps) {\r\n  const visibleControls = { leave: true, microphone: true, ...controls };\r\n\r\n  const localPermissions = useLocalParticipantPermissions();\r\n  const { microphoneTrack, localParticipant } = useLocalParticipant();\r\n\r\n  const micTrackRef: TrackReferenceOrPlaceholder = React.useMemo(() => {\r\n    return {\r\n      participant: localParticipant,\r\n      source: Track.Source.Microphone,\r\n      publication: microphoneTrack,\r\n    };\r\n  }, [localParticipant, microphoneTrack]);\r\n\r\n  if (!localPermissions) {\r\n    visibleControls.microphone = false;\r\n  } else {\r\n    visibleControls.microphone ??= localPermissions.canPublish;\r\n  }\r\n\r\n  const htmlProps = mergeProps({ className: 'lk-agent-control-bar' }, props);\r\n\r\n  const { saveAudioInputEnabled, saveAudioInputDeviceId } = usePersistentUserChoices({\r\n    preventSave: !saveUserChoices,\r\n  });\r\n\r\n  const microphoneOnChange = React.useCallback(\r\n    (enabled: boolean, isUserInitiated: boolean) => {\r\n      if (isUserInitiated) {\r\n        saveAudioInputEnabled(enabled);\r\n      }\r\n    },\r\n    [saveAudioInputEnabled],\r\n  );\r\n\r\n  return (\r\n    <div {...htmlProps}>\r\n      {visibleControls.microphone && (\r\n        <div className=\"lk-button-group\">\r\n          <TrackToggle\r\n            source={Track.Source.Microphone}\r\n            showIcon={true}\r\n            onChange={microphoneOnChange}\r\n            onDeviceError={(error) => onDeviceError?.({ source: Track.Source.Microphone, error })}\r\n          >\r\n            <BarVisualizer trackRef={micTrackRef} barCount={7} options={{ minHeight: 5 }} />\r\n          </TrackToggle>\r\n          <div className=\"lk-button-group-menu\">\r\n            <MediaDeviceMenu\r\n              kind=\"audioinput\"\r\n              onActiveDeviceChange={(_kind, deviceId) =>\r\n                saveAudioInputDeviceId(deviceId ?? 'default')\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {visibleControls.leave && <DisconnectButton>{'Disconnect'}</DisconnectButton>}\r\n      <StartMediaButton />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["Chat","messageFormatter","messageDecoder","messageEncoder","channelTopic","props","inputRef","React","ulRef","chatOptions","send","chatMessages","isSending","useChat","layoutContext","useMaybeLayoutContext","lastReadMsgAt","handleSubmit","event","_a","_b","_c","unreadMessageCount","msg","widget","_d","_e","ChatToggle","ChatCloseIcon","idx","cloneSingleChild","allMsg","hideName","hideTimestamp","ChatEntry","ev","MediaDeviceMenu","kind","initialSelection","onActiveDeviceChange","tracks","requestPermissions","isOpen","setIsOpen","devices","setDevices","updateRequired","setUpdateRequired","needPermissions","setNeedPermissions","handleActiveDeviceChange","deviceId","log","button","tooltip","computeMenuPosition","x","y","handleClickOutside","wasClickOutside","MediaDeviceSelect","useWarnAboutMissingStyles","warnAboutMissingStyles","usePreviewTracks","options","onError","setTracks","trackLock","Mutex","needsCleanup","localTracks","unlock","createLocalTracks","tr","e","track","roomOptionsStringifyReplacer","usePreviewDevice","enabled","deviceError","setDeviceError","isCreatingTrack","setIsCreatingTrack","useMediaDevices","selectedDevice","setSelectedDevice","localTrack","setLocalTrack","localDeviceId","setLocalDeviceId","createTrack","createLocalVideoTrack","VideoPresets","createLocalAudioTrack","newDeviceId","prevDeviceId","switchDevice","id","dev","PreJoin","defaults","onValidate","onSubmit","debug","joinLabel","micLabel","camLabel","userLabel","persistUserChoices","videoProcessor","htmlProps","initialUserChoices","saveAudioInputDeviceId","saveAudioInputEnabled","saveVideoInputDeviceId","saveVideoInputEnabled","saveUsername","usePersistentUserChoices","userChoices","setUserChoices","audioEnabled","setAudioEnabled","videoEnabled","setVideoEnabled","audioDeviceId","setAudioDeviceId","videoDeviceId","setVideoDeviceId","username","setUsername","videoEl","videoTrack","Track","facingMode","facingModeFromLocalTrack","audioTrack","isValid","setIsValid","handleValidation","values","newUserChoices","ParticipantPlaceholder","TrackToggle","_","inputEl","useSettingsToggle","dispatch","state","useLayoutContext","className","mergeProps","SettingsMenuToggle","ref","mergedProps","ControlBar","variation","controls","saveUserChoices","onDeviceError","isChatOpen","setIsChatOpen","defaultVariation","useMediaQuery","visibleControls","localPermissions","useLocalParticipantPermissions","showIcon","showText","browserSupportsScreenSharing","supportsScreenSharing","isScreenShareEnabled","setIsScreenShareEnabled","onScreenShareChange","microphoneOnChange","isUserInitiated","cameraOnChange","error","_kind","ChatIcon","GearIcon","DisconnectButton","LeaveIcon","StartMediaButton","VideoConference","chatMessageFormatter","chatMessageDecoder","chatMessageEncoder","SettingsComponent","widgetState","setWidgetState","lastAutoFocusedScreenShareTrack","useTracks","RoomEvent","widgetUpdate","useCreateLayoutContext","screenShareTracks","isTrackReference","focusTrack","usePinnedTracks","carouselTracks","isEqualTrackRef","updatedFocusTrack","_f","isWeb","LayoutContextProvider","FocusLayoutContainer","CarouselLayout","ParticipantTile","FocusLayout","GridLayout","RoomAudioRenderer","ConnectionStateToast","AudioConference","audioTracks","TrackLoop","ParticipantAudioTile","VoiceAssistantControlBar","microphoneTrack","localParticipant","useLocalParticipant","micTrackRef","BarVisualizer"],"mappings":"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"}